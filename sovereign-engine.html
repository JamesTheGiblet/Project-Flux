<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sovereign Engine - Hackable Game Framework</title>
<style>
	* { margin: 0; padding: 0; box-sizing: border-box; }
	body {
		font-family: 'Courier New', monospace;
		background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
		color: #00ff88;
		overflow: hidden;
		height: 100vh;
	}
	.container { display: flex; height: 100vh; }
	.game-area {
		flex: 1;
		position: relative;
		background: #000;
		border: 2px solid #00ff88;
		margin: 10px;
	}
	#gameCanvas {
		width: 100%;
		height: 100%;
		background: #0a0a0a;
	}
	.top-right-ui {
		position: absolute;
		top: 20px;
		right: 20px;
		display: flex;
		flex-direction: column;
		align-items: flex-end;
		gap: 10px;
		z-index: 100;
	}
	#activePowerUpsContainer {
		display: flex;
		gap: 8px;
	}
	.powerup-icon {
		background: rgba(0,0,0,0.7);
		border: 1px solid #fff;
		color: #fff;
		width: 30px;
		height: 30px;
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 12px;
		font-weight: bold;
	}
	.mod-panel {
		width: 300px;
		background: rgba(16, 33, 62, 0.9);
		border-left: 2px solid #00ff88;
		padding: 15px;
		overflow-y: auto;
		-webkit-backdrop-filter: blur(10px);
		backdrop-filter: blur(10px);
	}
	.header {
		text-align: center;
		padding: 15px;
		border-bottom: 1px solid #00ff88;
		margin-bottom: 15px;
	}
	.header h1 {
		font-size: 20px;
		color: #00ff88;
		text-shadow: 0 0 10px #00ff88;
	}
	.header p {
		color: #888;
		font-size: 10px;
		margin-top: 3px;
	}
	.mod-section {
		margin-bottom: 20px;
	}
	.mod-section h3 {
		color: #ff6b00;
		border-bottom: 1px solid #ff6b00;
		padding-bottom: 3px;
		margin-bottom: 8px;
		font-size: 12px;
	}
	.code-editor {
		background: #1a1a1a;
		border: 1px solid #333;
		color: #00ff88;
		font-family: 'Courier New', monospace;
		font-size: 10px;
		width: 100%;
		height: 100px;
		resize: vertical;
		padding: 8px;
		margin-bottom: 8px;
	}
	.apply-btn {
		background: #ff6b00;
		color: #000;
		border: none;
		padding: 6px 12px;
		border-radius: 3px;
		cursor: pointer;
		font-weight: bold;
		font-size: 11px;
		width: 100%;
		transition: all 0.3s ease;
	}
	.save-preset-area {
		display: flex;
		margin-top: 8px;
	}
	.preset-name-input {
		flex-grow: 1;
		background: #1a1a1a;
		border: 1px solid #333;
		color: #00ff88;
		padding: 6px;
		font-family: 'Courier New', monospace;
		font-size: 10px;
		margin-right: 5px;
	}
	.save-btn {
		background: #005588;
		color: #fff;
		border: none;
		padding: 6px 10px;
		cursor: pointer;
	}
	.execute-btn:hover {
		background: #88ffff;
		box-shadow: 0 0 8px rgba(0, 255, 255, 0.7);
	}
	.stats {
		position: fixed;
		top: 20px;
		left: 20px;
		background: rgba(0, 0, 0, 0.8);
		padding: 8px;
		border: 1px solid #00ff88;
		border-radius: 3px;
		color: #00ff88;
		font-size: 11px;
		-webkit-backdrop-filter: blur(5px);
		backdrop-filter: blur(5px);
		z-index: 100;
	}
	.manifesto {
		background: rgba(0, 0, 0, 0.9);
		border: 1px solid #ff6b00;
		border-radius: 3px;
		padding: 10px;
		margin-bottom: 15px;
		font-size: 9px;
		line-height: 1.3;
	}
	.manifesto-title {
		color: #ff6b00;
		font-weight: bold;
		margin-bottom: 5px;
	}
	.tutorial-summary {
		color: #00ffff;
		border-bottom: 1px solid #00ffff;
		padding-bottom: 3px;
		margin-bottom: 8px;
		font-size: 12px;
		cursor: pointer;
		font-weight: bold;
		list-style: none; /* Hide default arrow */
	}
	.tutorial-summary::-webkit-details-marker {
		display: none; /* Hide default arrow for Chrome */
	}
	.tutorial-summary:before {
		content: 'â–º ';
		font-size: 10px;
	}
	details[open] > .tutorial-summary:before {
		content: 'â–¼ ';
	}
	.tutorial-content {
		font-size: 10px;
		line-height: 1.4;
		color: #ccc;
		padding-left: 5px;
		border-left: 1px solid #333;
		margin-top: 10px;
	}
	.tutorial-content h4 {
		color: #ff6b00;
		margin-top: 10px;
		margin-bottom: 5px;
	}
	.tutorial-content p {
		margin-bottom: 5px;
	}
	.tutorial-content code {
		background: #1a1a1a;
		color: #00ff88;
		padding: 1px 4px;
		border-radius: 2px;
		font-size: 9px;
	}
	.tutorial-content pre {
		background: #1a1a1a;
		border: 1px solid #333;
		padding: 5px;
		margin: 5px 0 10px 0;
		border-radius: 3px;
		white-space: pre-wrap;
	}
	.tutorial-content pre code {
		padding: 0;
		background: none;
	}
	</style>
</head>
<body>
	<div class="container">
		<div class="game-area">
			<canvas id="gameCanvas"></canvas>
			<div class="stats" id="gameStats">
				FPS: <span id="fps">60</span><br>
				Objects: <span id="objectCount">0</span><br>
				Score: <span id="score">0</span>
			</div>
			<div class="top-right-ui">
				<div id="activePowerUpsContainer">
					</div>
			</div>
		</div>
		
		<div class="mod-panel">
			<div class="header">
				<h1>SOVEREIGN ENGINE</h1>
				<p>Hackable. Modular. Yours.</p>
			</div>

Â  Â  Â  Â  Â  Â  <div class="manifesto">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="manifesto-title">âš¡ BUILDER'S MANIFESTO</div>
Â  Â  Â  Â  Â  Â  Â  Â  Every pixel is hackable. Every rule is rewritable. This is sovereign softwareâ€”no gatekeepers, just pure creative freedom.
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mod-section">
Â  Â  Â  Â  Â  Â  Â  Â  <details>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <summary class="tutorial-summary">ğŸ“– HOW TO HACK</summary>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="tutorial-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Welcome, builder! This engine is yours to command. Here's how to write your own mods.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>ğŸ”« Weapon Mods</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Define how your weapon fires using the function: <code>function shoot(player, target, engine)</code>. To fire a bullet, add an object to <code>engine.projectiles</code>.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <pre><code>// Example: A slow, powerful shot
engine.projectiles.push({
Â  x: player.x, y: player.y,
Â  vx: (target.x - player.x) / 5,
Â  vy: (target.y - player.y) / 5,
Â  size: 8, color: '#ff00ff',
Â  life: 3, // Seconds until it disappears
Â  damage: 50
});</code></pre>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>ğŸ® Rule Mods</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Control the game's logic every frame using: <code>function update(engine, dt)</code>. You can use it to control enemy spawning, difficulty, or any other global game logic. Use <code>dt</code> (delta-time) for smooth, frame-rate independent logic.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <pre><code>// Spawn a special enemy every 5 seconds
if (engine.gameTime % 5 < dt) {
Â  engine.spawnEnemy({
Â  Â  health: 100, size: 15,
Â  Â  color: '#00ffff',
Â  Â  ai_type: 'linear' // or 'chase'
Â  });
}</code></pre>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>ğŸ§ Player Mods</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Change your character's stats using: <code>function modifyPlayer(player)</code>. This is run once when you click "Apply".</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <pre><code>// Make the player super fast!
player.speed = 500;
player.color = '#ffff00';</code></pre>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>ğŸ’¾ Saving & Hacking</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Use the <b>Save</b> button to store your creations. They'll be here next time you play! The <b>Hack The System</b> panel gives you direct, raw access to the entire 'game' object. Use with caution... or don't!</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </details>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mod-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ”« WEAPON MOD</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="weaponSelector" title="Select weapon mod preset" onchange="selectPreset('weapon', this.value)"></select>
Â  Â  Â  Â  Â  Â  Â  Â  <textarea class="code-editor" id="weaponCode" placeholder="Write or modify weapon code here..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="apply-btn" onclick="applyMod('weapon')">Apply Weapon</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="save-preset-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="preset-name-input" id="weaponPresetName" placeholder="Save as new preset...">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="save-btn" onclick="savePreset('weapon')">ğŸ’¾ Save</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mod-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ® RULES MOD</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="ruleSelector" title="Select rule mod preset" onchange="selectPreset('rule', this.value)"></select>
Â  Â  Â  Â  Â  Â  Â  Â  <textarea class="code-editor" id="ruleCode" placeholder="Write or modify game rules here..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="apply-btn" onclick="applyMod('rule')">Apply Rules</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="save-preset-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="preset-name-input" id="rulePresetName" placeholder="Save as new preset...">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="save-btn" onclick="savePreset('rule')">ğŸ’¾ Save</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mod-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ§ PLAYER MOD</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="playerSelector" title="Select player mod preset" onchange="selectPreset('player', this.value)"></select>
Â  Â  Â  Â  Â  Â  Â  Â  <textarea class="code-editor" id="playerCode" placeholder="Write or modify player properties here..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="apply-btn" onclick="applyMod('player')">Apply Player</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="save-preset-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="preset-name-input" id="playerPresetName" placeholder="Save as new preset...">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="save-btn" onclick="savePreset('player')">ğŸ’¾ Save</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

			<div class="mod-section">
				<h3>ğŸ’» HACK THE SYSTEM</h3>
				<textarea class="code-editor" id="hackCode" placeholder="/* DANGER ZONE */
// Code here has direct access to the 'game' object.
// Examples:
// player.health = 999;
// game.score += 1000;"></textarea>
				<button class="execute-btn" onclick="executeHack()">âš¡ Execute</button>
			</div>
		</div>
	</div>

	<script src="engine.js"></script>
	<script src="power-ups.js"></script>
	<script src="mod-loader.js"></script>
	<script>
		// --- MOD SYSTEM ---

Â  Â  Â  Â  function selectPreset(modType, presetName) {
Â  Â  Â  Â  Â  Â  const textarea = document.getElementById(`${modType}Code`);
Â  Â  Â  Â  Â  Â  const presets = game.allPresets[modType];
Â  Â  Â  Â  Â  Â  if (presets && presets[presetName]) {
Â  Â  Â  Â  Â  Â  Â  Â  textarea.value = presets[presetName];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function applyMod(modType) {
Â  Â  Â  Â  Â  Â  const code = document.getElementById(`${modType}Code`).value;
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const functionBody = code.substring(code.indexOf('{') + 1, code.lastIndexOf('}'));
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  switch(modType) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'weapon':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.weaponShoot = new Function('player', 'target', 'engine', functionBody);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'rule':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.rulesUpdate = new Function('engine', 'dt', functionBody);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'player':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const modFunc = new Function('player', functionBody);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modFunc(game.player);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  console.log(`${modType.charAt(0).toUpperCase() + modType.slice(1)} mod applied!`);
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  alert(`Error in ${modType} code: ` + e.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function savePreset(modType) {
Â  Â  Â  Â  Â  Â  const nameInput = document.getElementById(`${modType}PresetName`);
Â  Â  Â  Â  Â  Â  const presetName = nameInput.value.trim();
Â  Â  Â  Â  Â  Â  const code = document.getElementById(`${modType}Code`).value;

Â  Â  Â  Â  Â  Â  if (!presetName) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Please enter a name for your preset.');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
            // Prevent overwriting a file-based mod
            if (modManifest[modType] && modManifest[modType][presetName]) {
Â  Â  Â  Â  Â  Â  Â  Â  alert(`Cannot overwrite a file-
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const storageKey = `sovereign_${modType}_mods`;
Â  Â  Â  Â  Â  Â  let customMods = JSON.parse(localStorage.getItem(storageKey)) || {};
Â  Â  Â  Â  Â  Â  customMods[presetName] = code;
Â  Â  Â  Â  Â  Â  localStorage.setItem(storageKey, JSON.stringify(customMods));

Â  Â  Â  Â  Â  Â  alert(`Preset "${presetName}" saved!`);
Â  Â  Â  Â  Â  Â  nameInput.value = '';
Â  Â  Â  Â  Â  Â  initializeModSystem();
Â  Â  Â  Â  Â  Â  selectPreset(modType, presetName);
Â  Â  Â  Â  }

Â  Â  Â  Â  function executeHack() {
Â  Â  Â  Â  Â  Â  const code = document.getElementById('hackCode').value;
Â  Â  Â  Â  Â  Â  if (!code) return; // Don't run empty code
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // The code is executed with 'game', 'player', and 'engine' available as variables.
Â  Â  Â  Â  Â  Â  Â  Â  const hackFunction = new Function('game', 'player', 'engine', code);
Â  Â  Â  Â  Â  Â  Â  Â  hackFunction(game, game.player, game);
Â  Â  Â  Â  Â  Â  Â  Â  console.log('%câš¡ Hack executed successfully!', 'color: #00ffff');
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Error in hack code: ' + e.message);
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Hack execution failed:', e);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function initializeModSystem() {
Â  Â  Â  Â  Â  Â  game.allPresets = { weapon: {}, rule: {}, player: {} };
Â  Â  Â  Â  Â  Â  const defaultPresets = { weapon: weaponPresets, rule: rulesPresets, player: playerPresets };

Â  Â  Â  Â  Â  Â  for (const modType in game.allPresets) {
Â  Â  Â  Â  Â  Â  Â  Â  const customMods = JSON.parse(localStorage.getItem(`sovereign_${modType}_mods`)) || {};
Â  Â  Â  Â  Â  Â  Â  Â  game.allPresets[modType] = { ...defaultPresets[modType], ...customMods };

Â  Â  Â  Â  Â  Â  Â  Â  const selector = document.getElementById(`${modType}Selector`);
Â  Â  Â  Â  Â  Â  Â  Â  selector.innerHTML = ''; // Clear dropdown

Â  Â  Â  Â  Â  Â  Â  Â  for (const presetName in game.allPresets[modType]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  option.value = presetName;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isCustom = !defaultPresets[modType].hasOwnProperty(presetName);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  option.textContent = isCustom ? `[C] ${presetName}` : presetName.charAt(0).toUpperCase() + presetName.slice(1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selector.appendChild(option);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
		let game;
		window.onload = function() {
			game = new SovereignEngine();
			initializeModSystem();

			// Select and apply default mods on startup
			selectPreset('weapon', 'default');
			selectPreset('rule', 'default');
			selectPreset('player', 'default');
			applyMod('rule');
			applyMod('player');

			console.log(`
ğŸš€ SOVEREIGN ENGINE LOADED
=======================
WASD/Arrows: Move
Mouse: Aim | Click/Space: Shoot
Edit code in the panel â†’
Every system is hackable!
`);
		};
	</script>
</body>
</html>